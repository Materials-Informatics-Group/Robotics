<!-- =================================================================================================
Project: REACH App â€” UI web application to control the REACH robot arm
Institution: Hokkaido University (2025)
Last Update: Q3 2025
-------------------------------------------------------------------------------------------------
Authors:
  â€¢ Mikael Nicander Kuwahara â€” Lead System Designer & Lead Developer (2024â€“)
-------------------------------------------------------------------------------------------------
File: index.html
Purpose:
  â€¢ Main UI layout for REACH: fixed header, voice controls, 2.5D Pick & Place, presets, manual command
    panel, macro manager, robot feedback, vision embed, history, and disconnect modal.
Notes:
  â€¢ No functional changes; added structure and comments only.
================================================================================================= -->

<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ===== Meta / Title / Fonts ===== -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>REACH Robot Arm Control</title>

  <!-- ===== Stylesheets ===== -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&family=Roboto&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="reach-control.css">
  <link rel="stylesheet" href="voice/voice.css">
</head>
<body>

  <!-- ============================================================================================
       Fixed Header (branding and subtitle)
  ============================================================================================= -->
  <div class="header" id="header">
    <div class="header-subtitle">Brought to you by Takahashi Group and Hokkaido University</div>
    <div class="title-block">
      <div>
        <h1 title="Robotic Extension Arm for Collaborative Handling">REACH</h1>
        <h2>Custom-made Robotic Arm from MNK</h2>
      </div>
      <img class="logo" src="logo.png" alt="REACH Logo">
    </div>
  </div>

  <!-- ============================================================================================
       Voice Commands Panel (toggle + status + help)
  ============================================================================================= -->
  <div class="panel" id="voice-command-panel">
    <div class="panel-header">
      <span class="toggle-btn">&#9650;</span>
      <span class="panel-title">Voice Commands</span>
    </div>

    <div class="voice-wrap" style="margin-top:.5rem;">
      <button id="voiceToggle" type="button">ğŸ™ï¸ Voice: Off</button>
      <span id="voiceStatus">idle</span>
      <span class="voice-hint" data-wakeword-hint style="display:none;"></span>
      <span class="voice-help-wrap">
        <button id="voiceHelpBtn" class="voice-help-btn" type="button" aria-haspopup="true" aria-expanded="false" aria-label="Voice help">i</button>
      </span>
    </div>

    <!-- NEW footer row just for audio toggle -->
    <div class="voice-audio-row" role="group" aria-labelledby="audioToggleLabel">
      <div id="audioToggleLabel" class="audio-toggle-title">Audio feedback</div>
      <label class="switch" title="Audio feedback on/off">
        <input type="checkbox" id="audioFeedbackToggle" />
        <span class="slider"></span>
      </label>
      <small class="audio-toggle-hint">Robot will speak confirmations and chime on events.</small>
    </div>
  </div>


  <!-- ============================================================================================
       2.5D Pick & Place (MVP) â€” UI inputs and Run button
  ============================================================================================= -->
  <div class="panel" id="pickplace-panel">
    <div class="panel-header">
      <span class="toggle-btn">&#9650;</span>
      <span class="panel-title">2.5D Pick & Place (MVP)</span>
    </div>

    <div class="preset-container">
      <div style="display:flex; gap:.5rem; flex-wrap:wrap; align-items:center;">
        <!-- Source selector: Tag or Color -->
        <label>Pick up:
          <select id="ppColor">
            <optgroup label="Tags">
              <option value="A">tag A</option><option value="B">tag B</option>
              <option value="C">tag C</option><option value="D">tag D</option>
              <option value="1">tag 1</option><option value="2">tag 2</option>
              <option value="3">tag 3</option><option value="4">tag 4</option>
            </optgroup>
            <optgroup label="Colors">
              <option value="red">red</option><option value="green">green</option>
              <option value="blue">blue</option><option value="yellow">yellow</option>
              <option value="orange">orange</option><option value="purple">purple</option>
            </optgroup>
          </select>
        </label>

        <!-- Destination tag -->
        <label>To place at:
          <select id="ppTag">
            <optgroup label="Tags">
              <option value="A">tag A</option><option value="B">tag B</option>
              <option value="C">tag C</option><option value="D">tag D</option>
              <option value="1">tag 1</option><option value="2">tag 2</option>
              <option value="3">tag 3</option><option value="4">tag 4</option>
            </optgroup>
            <optgroup label="Colors">
              <option value="red">red</option><option value="green">green</option>
              <option value="blue">blue</option><option value="yellow">yellow</option>
              <option value="orange">orange</option><option value="purple">purple</option>
            </optgroup>
          </select>
        </label>

        <!-- Operation (place/drop/pour) -->
        <label>Operation:
          <select id="ppOp">
            <option value="place">grab â†’ place (gentle)</option>
            <option value="drop">grab â†’ drop (no lower)</option>
            <option value="pour">grab â†’ pour â†’ return</option>
          </select>
        </label>

        <button id="ppRun">Run Task</button>
        <span id="ppStatus" style="margin-left:.5rem;color:#7ad;">Idle</span>
      </div>
    </div>
  </div>

  <!-- ============================================================================================
       Preset Positions (quick actions)
  ============================================================================================= -->
  <div class="panel" id="preset-panel">
    <div class="panel-header">
      <span class="toggle-btn">&#9650;</span>
      <span class="panel-title">Preset Positions</span>
    </div>
    <div class="preset-container">
      <!-- Preset Button Grid -->
      <div class="preset-grid">
        <button class="preset-btn" onclick="sendPreset('SLP')" title="Sleep Position">SLP</button>
        <button class="preset-btn" onclick="sendPreset('CTR')" title="Center Arm">CTR</button>
        <button class="preset-btn" onclick="sendPreset('PLT')" title="Prepare Left-side Pickup">PLT</button>
        <button class="preset-btn" onclick="sendPreset('PRT')" title="Prepare Right-side Pickup">PRT</button>
        <button class="preset-btn" onclick="sendPreset('PCL')" title="Prepare Gripping">PCL</button>
        <button class="preset-btn" onclick="sendPreset('GRP')" title="Grip Object">GRP</button>
        <button class="preset-btn" onclick="sendPreset('REL')" title="Release Object">REL</button>
        <button class="preset-btn" onclick="sendPreset('LFT')" title="Lift Object">LFT</button>
      </div>
    </div>
  </div>

  <!-- ============================================================================================
       Robot Vision (embedded panel â€” collapsible)
  ============================================================================================= -->
  <div class="panel collapsed" id="vision-panel">
    <div class="panel-header">
      <span class="toggle-btn">&#9650;</span>
      <span class="panel-title">Robot Vision</span>
    </div>

    <div class="vision-block">
      <iframe src="/vision/panel" style="width:100%; height:540px; border:0;"></iframe>
    </div>
    <!-- Alternate browser vision panel:
    <div class="vision-block">
      <iframe src="/vision/panel_browser" style="width:100%; height:560px; border:0;"></iframe>
    </div> -->
  </div>

  <!-- ============================================================================================
       Manual Commands (single tokens / combos + live validation + sliders)
  ============================================================================================= -->
  <div class="panel" id="manual-command-panel">
    <div class="panel-header">
      <span class="toggle-btn">&#9650;</span><span class="panel-title">Manual Commands</span>
    </div>
    <input type="text" id="commandInput" placeholder="Enter command" />
    <button onclick="sendCommand()">Send</button>
    <div id="servo-slider-grid" class="servo-slider-grid"></div>
    <div id="command-preview" style="margin-top: 0.5em; font-size: 0.9em; color: #555;"></div>
  </div>

  <!-- ============================================================================================
       Macro Management (editor, save/load, play, loop)
  ============================================================================================= -->
  <div class="panel" id="macro-manager-panel">
    <div class="panel-header">
      <span class="toggle-btn">&#9650;</span><span class="panel-title">Macro Management</span>
    </div>
    <div class="macro-controls">
      <div class="macro-row">
        <button onclick="macroAddCurrentState()">â• Save Current State</button>
        <button onclick="macroAddWait()">â±ï¸ Add WAIT</button>
        <input type="number" id="waitDuration" min="1" max="99" value="1" title="Seconds" />
        <button onclick="macroAddBMD()">ğŸ•¹ Add BMD</button>
        <input type="number" id="bmdDuration" min="0" max="5000" step="100" value="300" title="Milliseconds" />
      </div>

      <div class="macro-row">
        <button onclick="macroClear()">ğŸ—‘ Clear</button>
        <button onclick="macroSaveToFile()">ğŸ’¾ Save</button>
        <button onclick="macroLoadFromFile()">ğŸ“‚ Load</button>
        <button onclick="macroPlay()">â–¶ï¸ Play</button>
        <button onclick="macroStop()">â›” Stop</button>
        <label class="switch">
          <input type="checkbox" id="macroLoopToggle">
          <span class="slider"></span>
        </label>
      </div>

      <textarea id="macroTextbox" rows="10" style="width: 100%; font-family: monospace;" placeholder="Macro steps will appear here..."></textarea>
      <div id="macroStatus" style="margin-top: 0.5em; font-size: 0.9em;"></div>
    </div>
  </div>

  <!-- ============================================================================================
       Robot Feedback (status + angle readouts)
  ============================================================================================= -->
  <div class="panel" id="robot-messaging-panel">
    <div class="panel-header">
      <span class="toggle-btn">&#9650;</span><span class="panel-title">Robot Feedback</span>
    </div>
    <div id="robot-feedback" style="margin-top:10px; font-weight:bold;"></div>
    <div id="angle-grid" class="angle-grid">
      <div class="servo-box">Base(0): --Â°</div>
      <div class="servo-box">Shoulder(1): --Â°</div>
      <div class="servo-box">Elbow(2): --Â°</div>
      <div class="servo-box">Wrist(3): --Â°</div>
      <div class="servo-box">Twist(4): --Â°</div>
      <div class="servo-box">Grip(5): --Â°</div>
    </div>
  </div>

  <!-- ============================================================================================
       Pre-made Macros (quick demo buttons)
  ============================================================================================= -->
  <div class="panel">
    <div class="panel-header">
      <span class="toggle-btn">&#9650;</span><span class="panel-title">Pre-made Macros</span>
    </div>
    <div class="preset-grid">
      <button class="preset-btn" onclick="runMacro('DM1')" title="Pick Up & Pour Demo">DEMO 1</button>
      <button class="preset-btn" onclick="runMacro('DM2')" title="Wave Demo">DEMO 2</button>
      <button class="preset-btn" onclick="runMacro('DM3')" title="Wavy Snake Dance Demo">DEMO 3</button>
      <button class="preset-btn" onclick="runMacro('SSLP')" title="SAFE SLEEP">SSLP</button>
      <button class="preset-btn" onclick="runMacro('SCTR')" title="SAFE CENTER">SCTR</button>
      <button class="preset-btn" onclick="runMacro('RSLP')" title="Reverse Sleep">RSLP</button>
    </div>
  </div>

  <!-- ============================================================================================
       Command History (sent vs response columns)
  ============================================================================================= -->
  <div class="panel collapsed" id="history-panel">
    <div class="panel-header">
      <span class="toggle-btn">&#9650;</span><span class="panel-title">Command History</span>
    </div>
    <button onclick="clearHistory()">ğŸ—‘ï¸ Clear</button>
    <div class="history-container">
      <div class="history-column">
        <h4>Sent Commands</h4>
        <ul id="sent-history" class="history-list"></ul>
      </div>
      <div class="history-column">
        <h4>Robot Responses</h4>
        <ul id="response-history" class="history-list"></ul>
      </div>
    </div>
  </div>

  <!-- ============================================================================================
       Disconnect Modal (blocks UI while robot is offline)
  ============================================================================================= -->
  <div id="disconnect-modal" class="modal hidden">
    <div class="modal-content">
      <h2>ğŸ”Œ Robot Disconnected</h2>
      <p>Please reconnect the robot. The interface is disabled until a connection is restored.</p>
      <div class="spinner"></div>
    </div>
  </div>

  <!-- ============================================================================================
       Scripts (voice integration first so it can register handlers; then core app; then pick/place)
  ============================================================================================= -->
  <script type="module" src="audio/audio.js"></script>
  <script type="module" src="voice/voice-integration.js?v=1.0.2"></script>  
  <script src="reach-control.js"></script>
  <script src="pickplace.js?v=1"></script>
</body>
</html>
